{% extends "admin/base.html" %}

{% block title %}Backups{% endblock title %}

{% block content %}
<div class="backups">
  <h1 class="backups__title">Backups</h1>

  <div class="backup-create">
    <h3 class="backup-create__title">Create Manual Backup</h3>
    <form method="post" action="{{ url_for('admin.backups') }}" class="backup-create__form">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="backup-create__field">
        <label for="description">Description</label>
        <input type="text" id="description" name="description"
               placeholder="e.g., pre-migration" required
               pattern="[a-zA-Z0-9\s\-]+" maxlength="50">
        <small>Letters, numbers, spaces, hyphens only</small>
      </div>

      <div class="backup-create__options">
        <label class="backup-create__checkbox">
          <input type="checkbox" name="upload_to_s3" checked>
          Upload to S3
        </label>
        <label class="backup-create__checkbox">
          <input type="checkbox" name="save_local">
          Save Locally
        </label>
      </div>

      <button type="submit" class="button backup-create__submit">Create Backup Now</button>
    </form>
  </div>

  <h2 class="backups__subtitle"><span class="fa-regular fa-folder-open">&nbsp;&nbsp;</span>
    {{ backup_bucket }} / {{ ' / '.join(prefix.split('/')) }}
  </h2>
  {% if prefix != '' %}
  <h3 class="backups__link"><a href="{{ url_for('admin.backups', prefix=up_one_level) }}">Up One Level</a></h3>
  {% endif %}

  <div class="bucket-contents">
    <div class="bucket-contents__header">Filename</div>
    <div class="bucket-contents__header">Last Modified</div>
    <div class="bucket-contents__header">Size</div>

    {% for folder in folders %}
    <div class="bucket-contents__item">
      <span class="fa-regular fa-folder-closed">&nbsp;&nbsp;</span>
      <a class="bucket-contents__link"
        href="{{ url_for('admin.backups', prefix=folder) }}">{{ folder.split('/')[-2] }}/</a>
    </div>
    <div class="bucket-contents__item"> </div>
    <div class="bucket-contents__item"> </div>
    {% endfor %}

    {% for backup in backups %}
    <div class="bucket-contents__item">
      <span class="fa-regular fa-floppy-disk">&nbsp;&nbsp;</span>{{ backup.filename }}
    </div>
    <div class="bucket-contents__item">{{ backup.last_modified }}</div>
    <div class="bucket-contents__item">{{ backup.size }}</div>
    {% endfor %}
  </div>
</div>
{% endblock content %}
