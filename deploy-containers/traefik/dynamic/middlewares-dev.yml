http:
  middlewares:
    # Development-specific middleware
    dev-cors:
      headers:
        accessControlAllowOriginList:
          - "https://app.docker.localhost"
          - "https://api.docker.localhost"
          - "https://chat.docker.localhost"
          - "http://localhost:3000"  # For frontend dev servers
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
          - "OPTIONS"
          - "PATCH"
        accessControlAllowHeaders:
          - "*"
        accessControlAllowCredentials: true

    # Aliased middlewares for compatibility with base compose file
    cors-prod:
      headers:
        accessControlAllowOriginList:
          - "https://app.docker.localhost"
          - "https://api.docker.localhost"
          - "https://chat.docker.localhost"
          - "http://localhost:3000"  # For frontend dev servers
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
          - "OPTIONS"
          - "PATCH"
        accessControlAllowHeaders:
          - "*"
        accessControlAllowCredentials: true

    security-headers-prod:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
        customResponseHeaders:
          X-Frame-Options: "SAMEORIGIN"  # More relaxed for dev
          X-Content-Type-Options: "nosniff"
        sslRedirect: true

    rate-limit-prod:
      rateLimit:
        burst: 1000  # More generous for dev
        average: 500

    websocket-prod:
      headers:
        customRequestHeaders:
          Connection: "upgrade"
          Upgrade: "websocket"

    # Relaxed security for development
    dev-security:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
        customResponseHeaders:
          X-Frame-Options: "SAMEORIGIN"  # More relaxed for dev
          X-Content-Type-Options: "nosniff"
        sslRedirect: true

    # Development debugging headers
    dev-debug:
      headers:
        customResponseHeaders:
          X-Debug-Mode: "true"
          X-Environment: "development"

    # WebSocket support for Streamlit
    websocket-headers:
      headers:
        customRequestHeaders:
          Connection: "upgrade"
          Upgrade: "websocket"
